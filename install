repo='hantbk/vtsbackup'
version=`get_latest_release`

get_latest_release() {
 	curl --silent "https://api.github.com/repos/$repo/releases/latest" | # Get latest release from GitHub api
 		grep '"tag_name":' |                                            # Get tag line
 		sed -E 's/.*"([^"]+)".*/\1/'                                    # Pluck JSON value
}


if [[ `uname` == 'Darwin' ]]; then
   platform='darwin'
else
   platform='linux'
fi

if [[ `arch` == 'arm64' ]]; then
 	arch='arm64'
else
 	arch='amd64'
fi

curl -SLo vtsbackup.tar.gz https://github.com/hantbk/vtsbackup/releases/download/$version/vtsbackup-$platform-$arch.tar.gz

tar zxf vtsbackup.tar.gz

if [[ `whoami` == 'root' ]]; then
   mv vtsbackup /usr/local/bin/vtsbackup
else
   sudo mv vtsbackup /usr/local/bin/vtsbackup
fi

mkdir -p ~/.vtsbackup && touch ~/.vtsbackup/vtsbackup.yml
rm vtsbackup.tar.gz
